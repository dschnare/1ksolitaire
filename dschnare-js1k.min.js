c.width=c.height=600;function d(f,h,k){f[3]=1;a.save();a.fillStyle="#fff";a.fillRect(h,k,e,g);a.strokeRect(h,k,e,g);a.fillStyle=f[1]%2?"red":"#000";a.translate(h+5,k+20);a.scale(2,2);a.fillText(f[0],0,0);a.restore()}
function j(f,h,k,m){c.width=600;if(1==l)n.length?p.push.apply(p,n.splice(-3).reverse()):(n=p.slice(),n.reverse(),p=[]);else if(l){q=l[0];for(r=10;~r;r--){k=s[r];t=k[k.length-1];if(6<r){if(l[2]==l[1].length-1&&(!t&&1==q[2]||t&&q[1]==t[1]&&q[2]==t[2]+1))m=1}else!t&&13==q[2]?m=1:t&&(q[1]%2!=t[1]%2&&q[2]==t[2]-1)&&(m=1);if(m){if(m=l[1][l[2]-1])m[3]=1;k.push.apply(k,l[1].splice(l[2]));break}}}a.fillStyle="red";for(r=10;~r;r--){t=0;for(w=s[r].length;t<w;t++)q=s[r][t],f=x*(r%7),h=6<r?0:y+z*t,q[3]?d(q,f,
h):(a.fillRect(f,h,e,g),a.strokeRect(f,h,e,g))}f=6*x;h=0;n.length&&a.fillRect(f,h,e,g);a.strokeRect(f,h,e,g);p.length&&d(p[p.length-1],7*x,0);l=0;setTimeout(j,16.66)}var r,t,w,q,A,n=[],p=[],B=["\u2660","\u2665","\u2663","\u2666"],s=[],y=100,e=50,g=60,x=e+25,z=20,l;for(r=51;~r;r--)q=r%13+1,A=B[t=r/13>>0],n[r]=[(1==q?"A":q)+A,t,q,0];n=n.sort(function(){return 0.5>Math.random()?-1:1});r=0;for(w=7;r<w;r++)for(t=r;t<w;t++)(s[t]=s[t]||[]).push(q=n.pop()),q[3]=r==t;s.push([],[],[],[]);
c.addEventListener("mouseup",function(f){function h(){return k>=u&&k<=u+e&&m>=v&&m<=v+g}var k=f.offsetX||f.layerX,m=f.offsetY||f.layerY,u,v;l=0;for(r=6;~r;r--)for(t=s[r].length-1;~t;t--){f=s[r][t];u=x*r;v=y+t*z;if(!f[3])break;if(h())return l=[f,s[r],t]}u=6*x;v=0;if(h())return l=1;u=7*x;v=0;t=p.length-1;f=p[t];h()&&(l=[f,p,t])});j();
